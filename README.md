# UCL-CSRI — UK Property Map + AI

An interactive Mapbox globe for exploring UK property prices over time.
See how prices evolve month-by-month, click anywhere to drill into the underlying numbers, and overlay live listings when you want to sanity-check what’s on the market right now.

The AI assistant is there to help you make decisions, not just summarize charts: it can explain what’s driving an area’s prices, highlight strengths/weaknesses, and (when you click a listing) give a practical take on whether something looks overpriced for its local context.

What you can do:
- Explore monthly price trends across the UK as **polygons** (postcode **areas / districts / sectors**).
- Toggle **postcode dots** (centroid points) and a **smooth heatmap** overlay.
- Click any region / postcode for stats + drilldown, and ask the built-in **AI assistant** for context.
- Enable **Live** to overlay current property listings (when available).

---

## Tech Stack

- **Frontend:** React + Vite, Mapbox GL JS (3D globe)
- **Backend:** FastAPI (Uvicorn) serving the built frontend + `/api/*`
- **AI:** Perplexity API (optional) for AI analysis
- **Live data source:** ScanSan API snapshot (listings), optionally geocoded to lat/lon
- **Offline processing:** Python script to build GeoJSON + monthly aggregates

---

## Quick Start (Local)

### 1) Install frontend
```bash
cd frontend
npm install
```

### 2) Set environment variables
Create a `.env` at repo root:
```bash
VITE_MAPBOX_TOKEN=pk.your_mapbox_token_here
PERPLEXITY_API_KEY=pplx_your_key_here   # optional (AI)
```

### 3) Build the data
```bash
python scripts/build_geojson.py
```

### 4) Build frontend + run backend
```bash
cd frontend
npm run build

cd ../backend
python main.py
```

Open: `http://localhost:8000`

---

## Data Inputs (3 datasets)

1) **PPD (historical transactions)** — `PPD/YYYY.csv` (Land Registry Price Paid Data)
2) **Code‑Point Open (postcode coordinates)** — `codepo_gb/Data/CSV/*.csv` (postcode → lat/lon centroids)
3) **GB Postcodes boundaries (polygons)** — `gb-postcodes-v5/` (GeoJSON boundaries)

Optional:
- **Predictions** — `predictions/bulk_property_predictions_YYYY.csv` (2026–2030)
- **Live listings snapshot** — `live/london_listings_geocoded.json`

---

## Generated Outputs (served by backend under `/data`)

- `data/polygons/*.geojson` (static boundaries; loaded once)
- `data/historical/stats/*.json` + `data/historical/postcode_points/*.geojson` (<= 2025)
- `data/predicted/stats/*.json` + `data/predicted/postcode_points/*.geojson` (2026–2030)
- `data/live/listings/listings.geojson` (current listings points; only real lat/lon)

---

## Notes / Gotchas

- Predictions are generated by a model trained on the PPD data. Clicking predicted months won’t show PPD transaction drilldown (by design).
- Large `data/`, `PPD/`, `predictions/`, `live/` are gitignored.
